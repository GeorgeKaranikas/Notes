# X-Frame-Options

Prohibits the browser which makes the request to embed the site that includes this header to a 'frame' tag like `<frame>`, `<iframe>`, `<embed>` or `<object>`.

- X-Frame-Options: DENY

- `Content-Security-Policy: frame-ancestors 'none';` CSP directive is more modern and prefered.






# Abusing Hop-By-Hop headers
`Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization`, and `Proxy-Authenticate` are all Hop-By-Hop Headers.
An http header is a hop-by-hop header meaning that is meant to have a purpose for a single connection and not passed around by servers like caches and load balancers. In contrast with End to End headers where they must persist between intermediates when set by User-Agents and consumed by back-end servers, or the other way around.

If a Hop-By-Hop server is present in the request , it must also be specified in `Connection` Header. This way they will be consumed by the first proxy.

#### HTTP Hop-by-Hop Header Injection

- Load Balancer

```
/etc/nginx/nginx.conf

location / {
    proxypass http://cacheserver;
    proxy_set_header Connection $http_connection;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_pass_request_headers on;
    }
```

- Cache

```
varnish

sub vcl_recv {
    if (req.http.X-Real-IP){
        set req.http.X-Forwarded-For = req.http.X-Real-IP;
    }
}
```

- You can bypass the check of X-Real-IP in the backend by appending it to the Connection header
- The load balancer will forward it as it constructs its connection header with the one of the http request
`Connection: keep-alive, X-Real-IP`
- The cache server will drop X-Real-IP before it reaches the the check code.
- The back end will receive a request with no X-real-IP header.

